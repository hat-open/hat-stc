<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="search" title="Search" href="../search.html" /><link rel="prev" title="hat-stc - Statechart library" href="../index.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>hat.stc - Python statechart library - hat-stc documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/drawio.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/hat.css?v=d90f72ce" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">hat-stc  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">hat-stc  documentation</span>
  
</a><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#"><cite>hat.stc</cite> - Python statechart library</a></li>
</ul>

</div></div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          

<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="hat-stc-python-statechart-library">
<h1><cite>hat.stc</cite> - Python statechart library<a class="headerlink" href="#hat-stc-python-statechart-library" title="Link to this heading">¶</a></h1>
<p>This library provides basic implementation of
<a class="reference external" href="https://en.wikipedia.org/wiki/UML_state_machine">hierarchical state machine</a>
engine. Statechart definition can be provided as structures defined by API or
by <a class="reference external" href="https://www.w3.org/TR/scxml/">SCXML definition</a>. Additionally,
<a class="reference external" href="https://graphviz.org/">Graphviz</a> DOT graph can be generated based on state
definition together with Sphinx extension <cite>hat.sphinx.scxml</cite>.</p>
<p>Notable differences between <cite>hat.stc</cite> and SCXML standard:</p>
<blockquote>
<div><ul class="simple">
<li><p>initial child state (in <cite>scxml</cite> and <cite>state</cite> tag) should be defined
only by setting parent’s <cite>initial</cite> attribute</p></li>
<li><p>transitions without associated event name are not supported</p></li>
<li><p>parallel substates are not supported</p></li>
<li><p>history pseudo-state is not supported</p></li>
<li><p>data model is not supported</p></li>
<li><p>external communications is not supported</p></li>
<li><p>all actions and conditions are identified by name - arbitrary expressions
or executable contents are not supported</p></li>
<li><p>transition event identifiers are used as exact event names without
support for substring segmentation matching</p></li>
</ul>
</div></blockquote>
<section id="tutorial">
<h2>Tutorial<a class="headerlink" href="#tutorial" title="Link to this heading">¶</a></h2>
<p>Hierarchical state machines (also known as statecharts) are abstractions
used as organization/implementation basis for algorithms that execute
continuous state changes. Interaction between “outside world” and statecharts
is usually represented with sequence of events that are directly responsible
for state changes.</p>
<p>In this tutorial, we will gradually introduce statechart concepts and
<cite>hat.stc</cite> functions/structures which will help implement those concepts.
All examples are available as part of <a class="reference external" href="https://github.com/hat-open/hat-core/tree/master/docs/libraries/stc">git repository</a> .</p>
<section id="statechart-definition">
<h3>Statechart definition<a class="headerlink" href="#statechart-definition" title="Link to this heading">¶</a></h3>
<p>As an example of trivial state machine, let us borrow simple example from
<a class="reference external" href="https://en.wikipedia.org/wiki/File:Finite_state_machine_example_with_comments.svg">Wikipedia</a>:</p>
<img alt="../_images/tutorial.svg" class="drawio align-center" src="../_images/tutorial.svg" />
<p>This diagram models simple door with only two states - <cite>opened</cite> and <cite>closed</cite>.
<cite>Opened</cite> is initial state which can transition to <cite>closed</cite> state once <cite>close</cite>
event occurs. Similarly, once in <cite>closed</cite> state, door can change to <cite>opened</cite>
state if <cite>open</cite> event occurs. Both states have associated entry action (named
<cite>printState</cite>) which is triggered each time state is entered.</p>
<p>The same statechart can be described with following SCXML definition:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/e9a92ae510c5648b3d5d8b03ae730b43/door_01.scxml"><code class="xref download docutils literal notranslate"><span class="pre">door_01.scxml</span></code></a></span><a class="headerlink" href="#id1" title="Link to this code">¶</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;scxml</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/2005/07/scxml&quot;</span><span class="w"> </span><span class="na">initial=</span><span class="s">&quot;opened&quot;</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;opened&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;onentry&gt;</span>printState<span class="nt">&lt;/onentry&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;close&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;closed&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/state&gt;</span>
<span class="w">    </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;closed&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;onentry&gt;</span>printState<span class="nt">&lt;/onentry&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;open&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;opened&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/state&gt;</span>
<span class="nt">&lt;/scxml&gt;</span>
</pre></div>
</div>
</div>
<p><cite>hat.stc</cite> library provides function <code class="docutils literal notranslate"><span class="pre">hat.stc.parse_scxml</span></code> which can be used
for parsing SCXML definitions into state definitions usable by
<code class="docutils literal notranslate"><span class="pre">hat.stc.Statechart</span></code>. Equivalent definition of this SCXML represented by
<code class="docutils literal notranslate"><span class="pre">hat.stc.State</span></code> definitions is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">State</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;opened&#39;</span><span class="p">,</span>
       <span class="n">transitions</span><span class="o">=</span><span class="p">[</span><span class="n">Transition</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;closed&#39;</span><span class="p">)],</span>
       <span class="n">entries</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;printState&#39;</span><span class="p">]),</span>
 <span class="n">State</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;closed&#39;</span><span class="p">,</span>
       <span class="n">transitions</span><span class="o">=</span><span class="p">[</span><span class="n">Transition</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;opened&#39;</span><span class="p">)],</span>
       <span class="n">entries</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;printState&#39;</span><span class="p">])]</span>
</pre></div>
</div>
<p>Both SCXML and <cite>hat.stc.State</cite> based definitions represent identical statechart
definition and it is up to user to chose more appropriate notation for
statechart definitions. In the rest of this tutorial, we will be using
SCXML definitions.</p>
</section>
<section id="creating-statechart-instance">
<h3>Creating statechart instance<a class="headerlink" href="#creating-statechart-instance" title="Link to this heading">¶</a></h3>
<p>Once we have prepared statechart definition (e.g. <code class="docutils literal notranslate"><span class="pre">door_01.scxml</span></code>), we can
create execution environment with new statechart instance:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/a56231dd281a33788490a5fcf37a5cd3/tutorial_01.py"><code class="xref download docutils literal notranslate"><span class="pre">tutorial_01.py</span></code></a></span><a class="headerlink" href="#id2" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">hat.stc</span>

<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">act_print_state</span><span class="p">(</span><span class="n">door</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;current state:&#39;</span><span class="p">,</span> <span class="n">door</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>

    <span class="n">states</span> <span class="o">=</span> <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">parse_scxml</span><span class="p">(</span><span class="s2">&quot;door_01.scxml&quot;</span><span class="p">)</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;printState&#39;</span><span class="p">:</span> <span class="n">act_print_state</span><span class="p">}</span>
    <span class="n">door</span> <span class="o">=</span> <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">Statechart</span><span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">actions</span><span class="p">)</span>

    <span class="c1"># TODO: run statechart</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>During instance initialization, together with state definitions, we provide
action bindings. Action bindings is dictionary which contains all action
names, used in state definitions, associated with regular functions
providing action implementation. In our case, definition contains action
<code class="docutils literal notranslate"><span class="pre">printState</span></code> (same action is used as entry action for both <cite>opened</cite> and
<cite>closed</cite> state) which is associated with <code class="docutils literal notranslate"><span class="pre">act_print_state</span></code> function - simple
function that prints current state of our statechart instance.</p>
<p>By keeping state definition separate from associated actions and statechart
instances, single list of state definitions can be used as blueprint for
creating arbitrary number of mutually independent instances.</p>
</section>
<section id="running-statechart">
<h3>Running statechart<a class="headerlink" href="#running-statechart" title="Link to this heading">¶</a></h3>
<p>Execution of statechart logic is controlled <cite>hat.stc.Statechart.step</cite> method.</p>
<p>During initialization, statechart will transition to initial state.</p>
<p>If <cite>hat.stc.Statechart.step</cite> method is used for executing statechart logic,
user is responsible for repetitive calling of <cite>step</cite> method which processes
one event at the time.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/8234daf427f4f2aadc08aef3cfe28b29/tutorial_02.py"><code class="xref download docutils literal notranslate"><span class="pre">tutorial_02.py</span> <span class="pre">-</span> <span class="pre">snippet</span></code></a></span><a class="headerlink" href="#id3" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;registering close event&#39;</span><span class="p">)</span>
    <span class="n">event</span> <span class="o">=</span> <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">)</span>
    <span class="n">door</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;registering open event&#39;</span><span class="p">)</span>
    <span class="n">event</span> <span class="o">=</span> <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
    <span class="n">door</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>By executing this example, following output can be expected:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">current</span> <span class="n">state</span><span class="p">:</span> <span class="n">opened</span>
<span class="n">registering</span> <span class="n">close</span> <span class="n">event</span>
<span class="n">current</span> <span class="n">state</span><span class="p">:</span> <span class="n">closed</span>
<span class="n">registering</span> <span class="nb">open</span> <span class="n">event</span>
<span class="n">current</span> <span class="n">state</span><span class="p">:</span> <span class="n">opened</span>
</pre></div>
</div>
</section>
<section id="representing-statechart-as-python-class">
<h3>Representing statechart as python class<a class="headerlink" href="#representing-statechart-as-python-class" title="Link to this heading">¶</a></h3>
<p>To provide clean interface, we can encapsulate our derived statechart
functionality as single class:</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/3897fd4587125ca842a64dcd45389f34/tutorial_03.py"><code class="xref download docutils literal notranslate"><span class="pre">tutorial_03.py</span> <span class="pre">-</span> <span class="pre">snippet</span></code></a></span><a class="headerlink" href="#id4" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">door_states</span> <span class="o">=</span> <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">parse_scxml</span><span class="p">(</span><span class="s1">&#39;door_01.scxml&#39;</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Door</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;printState&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_act_print_state</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stc</span> <span class="o">=</span> <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">Statechart</span><span class="p">(</span><span class="n">door_states</span><span class="p">,</span> <span class="n">actions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_runner</span> <span class="o">=</span> <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">SyncRunner</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runner</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_runner</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;registering close event&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_runner</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stc</span><span class="p">,</span> <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;registering open event&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_runner</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stc</span><span class="p">,</span> <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_act_print_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stc</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;current state:&#39;</span><span class="p">,</span> <span class="n">stc</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In this example, we have used <cite>hat.stc.SyncRunner</cite> as example of simple
event queue. With <cite>hat.stc.SyncRunner.register</cite> method, events are added
to end of the queue which is emptied in FIFO manner.</p>
<p>Now we can instantiate and test our simple door:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/3897fd4587125ca842a64dcd45389f34/tutorial_03.py"><code class="xref download docutils literal notranslate"><span class="pre">tutorial_03.py</span> <span class="pre">-</span> <span class="pre">snippet</span></code></a></span><a class="headerlink" href="#id5" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">door</span> <span class="o">=</span> <span class="n">Door</span><span class="p">()</span>
    <span class="n">door</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="n">door</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">door</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="n">door</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
    <span class="n">door</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>This execution produces same result as our previous example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">current</span> <span class="n">state</span><span class="p">:</span> <span class="n">opened</span>
<span class="n">registering</span> <span class="n">close</span> <span class="n">event</span>
<span class="n">current</span> <span class="n">state</span><span class="p">:</span> <span class="n">closed</span>
<span class="n">registering</span> <span class="nb">open</span> <span class="n">event</span>
<span class="n">current</span> <span class="n">state</span><span class="p">:</span> <span class="n">opened</span>
</pre></div>
</div>
</section>
<section id="processing-registered-events">
<h3>Processing registered events<a class="headerlink" href="#processing-registered-events" title="Link to this heading">¶</a></h3>
<p>To help our analysis of event processing, we will introduce “force” to our
operations of door closing and opening. This “force” will be represented
with number in range [<cite>0</cite>, <cite>100</cite>] where <cite>0</cite> represents minimal opening/closing
force and <cite>100</cite> represents maximal opening/closing force.</p>
<p>This enhancement can be represented with following changes to door methods:</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/c845d2e69cf121dcbb3e9520995d24ca/tutorial_04.py"><code class="xref download docutils literal notranslate"><span class="pre">tutorial_04.py</span> <span class="pre">-</span> <span class="pre">snippet</span></code></a></span><a class="headerlink" href="#id6" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;registering close event&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_runner</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stc</span><span class="p">,</span> <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="n">force</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;registering open event&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_runner</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stc</span><span class="p">,</span> <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="n">force</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_act_print_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stc</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="n">force</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">payload</span> <span class="k">if</span> <span class="n">evt</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;force </span><span class="si">{</span><span class="n">force</span><span class="si">}</span><span class="s1"> caused transition to </span><span class="si">{</span><span class="n">stc</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now our test sequence:</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/c845d2e69cf121dcbb3e9520995d24ca/tutorial_04.py"><code class="xref download docutils literal notranslate"><span class="pre">tutorial_04.py</span> <span class="pre">-</span> <span class="pre">snippet</span></code></a></span><a class="headerlink" href="#id7" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. example:&quot;</span><span class="p">)</span>
    <span class="n">door</span> <span class="o">=</span> <span class="n">Door</span><span class="p">()</span>
    <span class="n">door</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="n">door</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">door</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>

    <span class="n">door</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">door</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>results in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">force</span> <span class="kc">None</span> <span class="n">caused</span> <span class="n">transition</span> <span class="n">to</span> <span class="n">opened</span>
<span class="n">registering</span> <span class="n">close</span> <span class="n">event</span>
<span class="n">force</span> <span class="mi">10</span> <span class="n">caused</span> <span class="n">transition</span> <span class="n">to</span> <span class="n">closed</span>
<span class="n">registering</span> <span class="nb">open</span> <span class="n">event</span>
<span class="n">force</span> <span class="mi">20</span> <span class="n">caused</span> <span class="n">transition</span> <span class="n">to</span> <span class="n">opened</span>
</pre></div>
</div>
<p>Each instance of <cite>hat.std.SyncRunner</cite> has it’s own event queue. All registered
events are added to the end of this queue. During execution of
<cite>Door.run</cite>, events are taken one at the time from begging of
event queue and checked for possible transitions. When transition is found,
it will cause statechart instance to change it’s state and execute all
appropriate actions. If transition paired with event could not be found,
event is discarded and statechart doesn’t change it’s state. Once all events
from the event queue are processed, <cite>Door.run</cite> will finish execution.</p>
<p>Taking this into account, execution of:</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/c845d2e69cf121dcbb3e9520995d24ca/tutorial_04.py"><code class="xref download docutils literal notranslate"><span class="pre">tutorial_04.py</span> <span class="pre">-</span> <span class="pre">snippet</span></code></a></span><a class="headerlink" href="#id8" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. example:&quot;</span><span class="p">)</span>
    <span class="n">door</span> <span class="o">=</span> <span class="n">Door</span><span class="p">()</span>
    <span class="n">door</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">door</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>

    <span class="n">door</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>results in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">force</span> <span class="kc">None</span> <span class="n">caused</span> <span class="n">transition</span> <span class="n">to</span> <span class="n">opened</span>
<span class="n">registering</span> <span class="n">close</span> <span class="n">event</span>
<span class="n">registering</span> <span class="nb">open</span> <span class="n">event</span>
<span class="n">force</span> <span class="mi">20</span> <span class="n">caused</span> <span class="n">transition</span> <span class="n">to</span> <span class="n">closed</span>
<span class="n">force</span> <span class="mi">50</span> <span class="n">caused</span> <span class="n">transition</span> <span class="n">to</span> <span class="n">opened</span>
</pre></div>
</div>
<p>Also, if we try to open already opened door or close already closed door,
this operations will be ignored. Therefore:</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/c845d2e69cf121dcbb3e9520995d24ca/tutorial_04.py"><code class="xref download docutils literal notranslate"><span class="pre">tutorial_04.py</span> <span class="pre">-</span> <span class="pre">snippet</span></code></a></span><a class="headerlink" href="#id9" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. example:&quot;</span><span class="p">)</span>
    <span class="n">door</span> <span class="o">=</span> <span class="n">Door</span><span class="p">()</span>
    <span class="n">door</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">door</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">door</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">door</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>

    <span class="n">door</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>results in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">force</span> <span class="kc">None</span> <span class="n">caused</span> <span class="n">transition</span> <span class="n">to</span> <span class="n">opened</span>
<span class="n">registering</span> <span class="nb">open</span> <span class="n">event</span>
<span class="n">registering</span> <span class="n">close</span> <span class="n">event</span>
<span class="n">registering</span> <span class="n">close</span> <span class="n">event</span>
<span class="n">registering</span> <span class="nb">open</span> <span class="n">event</span>
<span class="n">force</span> <span class="mi">20</span> <span class="n">caused</span> <span class="n">transition</span> <span class="n">to</span> <span class="n">closed</span>
<span class="n">force</span> <span class="mi">40</span> <span class="n">caused</span> <span class="n">transition</span> <span class="n">to</span> <span class="n">opened</span>
</pre></div>
</div>
</section>
<section id="working-with-timeouts">
<h3>Working with timeouts<a class="headerlink" href="#working-with-timeouts" title="Link to this heading">¶</a></h3>
<p>As you have probably noticed, our door model reacts to close event by
immediately closing the door and to open event by immediately opening the door.
More realistic model would include transition states (<cite>closing</cite> and <cite>opening</cite>).
Duration of door being in one of these transition states should be inversely
proportional to the amount of applied force.</p>
<img alt="../_images/tutorial1.svg" class="drawio align-center" src="../_images/tutorial1.svg" />
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/7ac9cb3786fe12844aa088c462527581/door_02.scxml"><code class="xref download docutils literal notranslate"><span class="pre">door_02.scxml</span></code></a></span><a class="headerlink" href="#id10" title="Link to this code">¶</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;scxml</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/2005/07/scxml&quot;</span><span class="w"> </span><span class="na">initial=</span><span class="s">&quot;opened&quot;</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;opened&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">        </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;close&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;closing&quot;</span><span class="nt">&gt;</span>logTransition<span class="nt">&lt;/transition&gt;</span>
<span class="w">    </span><span class="nt">&lt;/state&gt;</span>
<span class="w">    </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;closing&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">        </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;onentry&gt;</span>startTimer<span class="nt">&lt;/onentry&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;timeout&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;closed&quot;</span><span class="nt">&gt;</span>logTransition<span class="nt">&lt;/transition&gt;</span>
<span class="w">    </span><span class="nt">&lt;/state&gt;</span>
<span class="w">    </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;closed&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">        </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;open&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;opening&quot;</span><span class="nt">&gt;</span>logTransition<span class="nt">&lt;/transition&gt;</span>
<span class="w">    </span><span class="nt">&lt;/state&gt;</span>
<span class="w">    </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;opening&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">        </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;onentry&gt;</span>startTimer<span class="nt">&lt;/onentry&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;timeout&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;opened&quot;</span><span class="nt">&gt;</span>logTransition<span class="nt">&lt;/transition&gt;</span>
<span class="w">    </span><span class="nt">&lt;/state&gt;</span>
<span class="nt">&lt;/scxml&gt;</span>
</pre></div>
</div>
</div>
<p>To help us about state transitions, we have added additional logs which
will inform us when state is entered (<code class="docutils literal notranslate"><span class="pre">logEnter</span></code>), state is exited
(<code class="docutils literal notranslate"><span class="pre">logExit</span></code>) and transition action is triggered (<code class="docutils literal notranslate"><span class="pre">logTransition</span></code>).
In addition to this logging actions, states <cite>closing</cite> and <cite>opening</cite> have
additional action responsible for starting timer with calculated timer delay.</p>
<p>To implement timer behavior, we will be using asyncio <a class="reference external" href="https://docs.python.org/3/library/asyncio-eventloop.html#asyncio.loop.call_later">loop.call_later</a>
and <cite>hat.stc.AsyncRunner</cite>.</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/943912eed5ca91b9d7cd0ef806ce03e5/tutorial_05.py"><code class="xref download docutils literal notranslate"><span class="pre">tutorial_05.py</span> <span class="pre">-</span> <span class="pre">snippet</span></code></a></span><a class="headerlink" href="#id11" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">door_states</span> <span class="o">=</span> <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">parse_scxml</span><span class="p">(</span><span class="s1">&#39;door_02.scxml&#39;</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Door</span><span class="p">:</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;logEnter&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_act_log_enter</span><span class="p">,</span>
                   <span class="s1">&#39;logExit&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_act_log_exit</span><span class="p">,</span>
                   <span class="s1">&#39;logTransition&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_act_log_transition</span><span class="p">,</span>
                   <span class="s1">&#39;startTimer&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_act_start_timer</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stc</span> <span class="o">=</span> <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">Statechart</span><span class="p">(</span><span class="n">door_states</span><span class="p">,</span> <span class="n">actions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_runner</span> <span class="o">=</span> <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">AsyncRunner</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">finish</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runner</span><span class="o">.</span><span class="n">async_close</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;registering close event&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_runner</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stc</span><span class="p">,</span> <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="n">force</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;registering open event&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_runner</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stc</span><span class="p">,</span> <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="n">force</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_act_log_enter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stc</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;entering state </span><span class="si">{</span><span class="n">stc</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_act_log_exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stc</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;exiting state </span><span class="si">{</span><span class="n">stc</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_act_log_transition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stc</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;transitioning because of event </span><span class="si">{</span><span class="n">evt</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_act_start_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stc</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="n">force</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">payload</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="n">force_to_delay</span><span class="p">(</span><span class="n">force</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;waiting for </span><span class="si">{</span><span class="n">delay</span><span class="si">}</span><span class="s1"> seconds&#39;</span><span class="p">)</span>
        <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
        <span class="n">loop</span><span class="o">.</span><span class="n">call_later</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runner</span><span class="o">.</span><span class="n">register</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stc</span><span class="p">,</span>
                        <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span><span class="s1">&#39;timeout&#39;</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">force_to_delay</span><span class="p">(</span><span class="n">force</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">force</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.1</span>
    <span class="k">if</span> <span class="n">force</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">force</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.001</span>
</pre></div>
</div>
</div>
<p>Execution our simple testing sequence:</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/943912eed5ca91b9d7cd0ef806ce03e5/tutorial_05.py"><code class="xref download docutils literal notranslate"><span class="pre">tutorial_05.py</span> <span class="pre">-</span> <span class="pre">snippet</span></code></a></span><a class="headerlink" href="#id12" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">door</span> <span class="o">=</span> <span class="n">Door</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">door</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">door</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">await</span> <span class="n">door</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>will result in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">entering</span> <span class="n">state</span> <span class="n">opened</span>
<span class="n">registering</span> <span class="n">close</span> <span class="n">event</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">opened</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">closing</span>
<span class="n">waiting</span> <span class="k">for</span> <span class="mf">0.07</span> <span class="n">seconds</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">closing</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">closed</span>
<span class="n">registering</span> <span class="nb">open</span> <span class="n">event</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">closed</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">opening</span>
<span class="n">waiting</span> <span class="k">for</span> <span class="mf">0.04</span> <span class="n">seconds</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">opening</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">opened</span>
</pre></div>
</div>
</section>
<section id="composite-states">
<h3>Composite states<a class="headerlink" href="#composite-states" title="Link to this heading">¶</a></h3>
<p>Our previous example had one major drawback - once <cite>opening</cite>/<cite>closing</cite> state
was entered, processing of future <cite>open</cite>/<cite>close</cite> events is possible only
after timeout occurs. This can be specially problematic in cases of long
timer duration which are responsible for leaving statechart “unresponsive” for
a long time.</p>
<p>This problem can be tackled by adding additional transitions to
<cite>closing</cite>/<cite>opening</cite> states which will enable “operation cancellation” by
returning from originating state.</p>
<p>In case of more complex statechart definitions, addition of transitions for
each possible event to each state can soon become hard to maintain. Alternative
to this approach is grouping states into hierarchy.</p>
<p>Each hierarchical statechart can be represented by equivalent non-hierarchical
state diagram but this can result in state diagrams that are harder to reason
about. Because of this, in most cases of complex definitions, we will prefer
hierarchical approach.</p>
<p>Hierarchical statechart definition:</p>
<img alt="../_images/tutorial2.svg" class="drawio align-center" src="../_images/tutorial2.svg" />
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/b149ec99e83e9303279f9eb1d838daa6/door_03.scxml"><code class="xref download docutils literal notranslate"><span class="pre">door_03.scxml</span></code></a></span><a class="headerlink" href="#id13" title="Link to this code">¶</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;scxml</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/2005/07/scxml&quot;</span><span class="w"> </span><span class="na">initial=</span><span class="s">&quot;open_group&quot;</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;open_group&quot;</span><span class="w"> </span><span class="na">initial=</span><span class="s">&quot;opened&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">        </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;close&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;close_group&quot;</span><span class="nt">&gt;</span>logTransition<span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;opened&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;/state&gt;</span>
<span class="w">        </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;opening&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>startTimer<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>stopTimer<span class="nt">&lt;/onexit&gt;</span>
<span class="w">            </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;timeout&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;opened&quot;</span><span class="nt">&gt;</span>logTransition<span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;/state&gt;</span>
<span class="w">    </span><span class="nt">&lt;/state&gt;</span>
<span class="w">    </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;close_group&quot;</span><span class="w"> </span><span class="na">initial=</span><span class="s">&quot;closing&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">        </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;open&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;opening&quot;</span><span class="nt">&gt;</span>logTransition<span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;closing&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>startTimer<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>stopTimer<span class="nt">&lt;/onexit&gt;</span>
<span class="w">            </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;timeout&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;closed&quot;</span><span class="nt">&gt;</span>logTransition<span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;/state&gt;</span>
<span class="w">        </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;closed&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;/state&gt;</span>
<span class="w">    </span><span class="nt">&lt;/state&gt;</span>
<span class="nt">&lt;/scxml&gt;</span>
</pre></div>
</div>
</div>
<p>Implementation of <cite>Door</cite> class can remain mostly the same with addition
of <cite>stopTimer</cite> action:</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/745ce21bef9916d07d6bcfa9007a1d22/tutorial_06.py"><code class="xref download docutils literal notranslate"><span class="pre">tutorial_06.py</span> <span class="pre">-</span> <span class="pre">snippet</span></code></a></span><a class="headerlink" href="#id14" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span><span class="w"> </span><span class="nf">_act_start_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stc</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="n">force</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">payload</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="n">force_to_delay</span><span class="p">(</span><span class="n">force</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;waiting for </span><span class="si">{</span><span class="n">delay</span><span class="si">}</span><span class="s1"> seconds&#39;</span><span class="p">)</span>
        <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">call_later</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_runner</span><span class="o">.</span><span class="n">register</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stc</span><span class="p">,</span>
                                      <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span><span class="s1">&#39;timeout&#39;</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_act_stop_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stc</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Execution of testing sequence</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/745ce21bef9916d07d6bcfa9007a1d22/tutorial_06.py"><code class="xref download docutils literal notranslate"><span class="pre">tutorial_06.py</span> <span class="pre">-</span> <span class="pre">snippet</span></code></a></span><a class="headerlink" href="#id15" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">door</span> <span class="o">=</span> <span class="n">Door</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">door</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
    <span class="c1"># sleeping for shorter period than it takes for door to close</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>

    <span class="n">door</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">await</span> <span class="n">door</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>produces following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">entering</span> <span class="n">state</span> <span class="n">open_group</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">opened</span>
<span class="n">registering</span> <span class="n">close</span> <span class="n">event</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">opened</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">open_group</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">close_group</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">closing</span>
<span class="n">waiting</span> <span class="k">for</span> <span class="mf">0.07</span> <span class="n">seconds</span>
<span class="n">registering</span> <span class="nb">open</span> <span class="n">event</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">closing</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">close_group</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">open_group</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">opening</span>
<span class="n">waiting</span> <span class="k">for</span> <span class="mf">0.04</span> <span class="n">seconds</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">opening</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">opened</span>
</pre></div>
</div>
</section>
<section id="advanced-transitions">
<h3>Advanced transitions<a class="headerlink" href="#advanced-transitions" title="Link to this heading">¶</a></h3>
<p>Together with regular transitions, <cite>hat.stc</cite> provides support for local
transitions and internal transitions.</p>
<p>Local transitions can not be used to change state and do not have target state.
Therefore, only useful part of local transition is possibility to associate
action which will be executed once appropriate event occurs without any state
changes.</p>
<p>This functionality can be used in our door simulation to process <cite>open</cite> events
inside <cite>open_group</cite> state and <cite>close</cite> events in <cite>close_group</cite> state.</p>
<img alt="../_images/tutorial3.svg" class="drawio align-center" src="../_images/tutorial3.svg" />
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/99d2853f7f5faed8a76e1409266349ca/door_04.scxml"><code class="xref download docutils literal notranslate"><span class="pre">door_04.scxml</span></code></a></span><a class="headerlink" href="#id16" title="Link to this code">¶</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;scxml</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/2005/07/scxml&quot;</span><span class="w"> </span><span class="na">initial=</span><span class="s">&quot;open_group&quot;</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;open_group&quot;</span><span class="w"> </span><span class="na">initial=</span><span class="s">&quot;opened&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">        </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;close&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;close_group&quot;</span><span class="nt">&gt;</span>logTransition<span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;open&quot;</span><span class="nt">&gt;</span>logInvalid<span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;opened&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;/state&gt;</span>
<span class="w">        </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;opening&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>startTimer<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>stopTimer<span class="nt">&lt;/onexit&gt;</span>
<span class="w">            </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;timeout&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;opened&quot;</span><span class="nt">&gt;</span>logTransition<span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;/state&gt;</span>
<span class="w">    </span><span class="nt">&lt;/state&gt;</span>
<span class="w">    </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;close_group&quot;</span><span class="w"> </span><span class="na">initial=</span><span class="s">&quot;closing&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">        </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;open&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;opening&quot;</span><span class="nt">&gt;</span>logTransition<span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;close&quot;</span><span class="nt">&gt;</span>logInvalid<span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;closing&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>startTimer<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>stopTimer<span class="nt">&lt;/onexit&gt;</span>
<span class="w">            </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;timeout&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;closed&quot;</span><span class="nt">&gt;</span>logTransition<span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;/state&gt;</span>
<span class="w">        </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;closed&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;/state&gt;</span>
<span class="w">    </span><span class="nt">&lt;/state&gt;</span>
<span class="nt">&lt;/scxml&gt;</span>
</pre></div>
</div>
</div>
<p>In door implementation, we should add implementation of <cite>logInvalid</cite> action:</p>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/846b1c3032f1c8159323236ae42aac0b/tutorial_07.py"><code class="xref download docutils literal notranslate"><span class="pre">tutorial_07.py</span> <span class="pre">-</span> <span class="pre">snippet</span></code></a></span><a class="headerlink" href="#id17" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span><span class="w"> </span><span class="nf">_act_log_invalid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stc</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;invalid operation </span><span class="si">{</span><span class="n">evt</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> in state </span><span class="si">{</span><span class="n">stc</span><span class="o">.</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Execution of testing sequence</p>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/846b1c3032f1c8159323236ae42aac0b/tutorial_07.py"><code class="xref download docutils literal notranslate"><span class="pre">tutorial_07.py</span> <span class="pre">-</span> <span class="pre">snippet</span></code></a></span><a class="headerlink" href="#id18" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">door</span> <span class="o">=</span> <span class="n">Door</span><span class="p">()</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">door</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">door</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">door</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">await</span> <span class="n">door</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>produces following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">entering</span> <span class="n">state</span> <span class="n">open_group</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">opened</span>
<span class="n">registering</span> <span class="nb">open</span> <span class="n">event</span>
<span class="n">invalid</span> <span class="n">operation</span> <span class="nb">open</span> <span class="ow">in</span> <span class="n">state</span> <span class="n">opened</span>
<span class="n">registering</span> <span class="n">close</span> <span class="n">event</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">opened</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">open_group</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">close_group</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">closing</span>
<span class="n">waiting</span> <span class="k">for</span> <span class="mf">0.08</span> <span class="n">seconds</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">closing</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">closed</span>
<span class="n">registering</span> <span class="n">close</span> <span class="n">event</span>
<span class="n">invalid</span> <span class="n">operation</span> <span class="n">close</span> <span class="ow">in</span> <span class="n">state</span> <span class="n">closed</span>
</pre></div>
</div>
</section>
<section id="transition-guards">
<h3>Transition guards<a class="headerlink" href="#transition-guards" title="Link to this heading">¶</a></h3>
<p>Each transition can have list of conditions which have to be met for event to
cause state transition. These condition guards are convenient way of adding
additional statechart logic without adding new states.</p>
<p>To demonstrate usage of transition conditions, we will update behavior of
our door definition by limiting number of times successful open/close
operations can occur during single door instance lifetime. Lets say that
we can open or close door maximum N times.</p>
<img alt="../_images/tutorial4.svg" class="drawio align-center" src="../_images/tutorial4.svg" />
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/ebd0b38feaaa41485110ba051b645889/door_05.scxml"><code class="xref download docutils literal notranslate"><span class="pre">door_05.scxml</span></code></a></span><a class="headerlink" href="#id19" title="Link to this code">¶</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;scxml</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/2005/07/scxml&quot;</span><span class="w"> </span><span class="na">initial=</span><span class="s">&quot;open_group&quot;</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;open_group&quot;</span><span class="w"> </span><span class="na">initial=</span><span class="s">&quot;opened&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">        </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;close&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;close_group&quot;</span><span class="w"> </span><span class="na">cond=</span><span class="s">&quot;isOperational&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span>logTransition
<span class="w">            </span>incCounter
<span class="w">        </span><span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;open&quot;</span><span class="nt">&gt;</span>logInvalid<span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;opened&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;/state&gt;</span>
<span class="w">        </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;opening&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>startTimer<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>stopTimer<span class="nt">&lt;/onexit&gt;</span>
<span class="w">            </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;timeout&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;opened&quot;</span><span class="nt">&gt;</span>logTransition<span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;/state&gt;</span>
<span class="w">    </span><span class="nt">&lt;/state&gt;</span>
<span class="w">    </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;close_group&quot;</span><span class="w"> </span><span class="na">initial=</span><span class="s">&quot;closing&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">        </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;open&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;opening&quot;</span><span class="w"> </span><span class="na">cond=</span><span class="s">&quot;isOperational&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span>logTransition
<span class="w">            </span>incCounter
<span class="w">        </span><span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;close&quot;</span><span class="nt">&gt;</span>logInvalid<span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;closing&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>startTimer<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>stopTimer<span class="nt">&lt;/onexit&gt;</span>
<span class="w">            </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;timeout&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;closed&quot;</span><span class="nt">&gt;</span>logTransition<span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;/state&gt;</span>
<span class="w">        </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;closed&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;/state&gt;</span>
<span class="w">    </span><span class="nt">&lt;/state&gt;</span>
<span class="nt">&lt;/scxml&gt;</span>
</pre></div>
</div>
</div>
<p>Condition <cite>isOperational</cite> and <cite>incCounter</cite> action have to be added to our
implementation:</p>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/a0b66f8aeed02f28a3dc1fbefcd31ce7/tutorial_08.py"><code class="xref download docutils literal notranslate"><span class="pre">tutorial_08.py</span> <span class="pre">-</span> <span class="pre">snippet</span></code></a></span><a class="headerlink" href="#id20" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_counter</span><span class="p">):</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;logEnter&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_act_log_enter</span><span class="p">,</span>
                   <span class="s1">&#39;logExit&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_act_log_exit</span><span class="p">,</span>
                   <span class="s1">&#39;logTransition&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_act_log_transition</span><span class="p">,</span>
                   <span class="s1">&#39;logInvalid&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_act_log_invalid</span><span class="p">,</span>
                   <span class="s1">&#39;startTimer&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_act_start_timer</span><span class="p">,</span>
                   <span class="s1">&#39;stopTimer&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_act_stop_timer</span><span class="p">,</span>
                   <span class="s1">&#39;incCounter&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_act_inc_counter</span><span class="p">}</span>
        <span class="n">conditions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;isOperational&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cond_is_operational</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_counter</span> <span class="o">=</span> <span class="n">max_counter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stc</span> <span class="o">=</span> <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">Statechart</span><span class="p">(</span><span class="n">door_states</span><span class="p">,</span> <span class="n">actions</span><span class="p">,</span> <span class="n">conditions</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_runner</span> <span class="o">=</span> <span class="n">hat</span><span class="o">.</span><span class="n">stc</span><span class="o">.</span><span class="n">AsyncRunner</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_act_inc_counter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stc</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cond_is_operational</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stc</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counter</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_counter</span>
</pre></div>
</div>
</div>
<p>Execution of testing sequence</p>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/a0b66f8aeed02f28a3dc1fbefcd31ce7/tutorial_08.py"><code class="xref download docutils literal notranslate"><span class="pre">tutorial_08.py</span> <span class="pre">-</span> <span class="pre">snippet</span></code></a></span><a class="headerlink" href="#id21" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">door</span> <span class="o">=</span> <span class="n">Door</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">door</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">door</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">door</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># we already operated on this door instance 3 times</span>
    <span class="n">door</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">await</span> <span class="n">door</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>produces following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">entering</span> <span class="n">state</span> <span class="n">open_group</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">opened</span>
<span class="n">registering</span> <span class="n">close</span> <span class="n">event</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">opened</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">open_group</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">close_group</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">closing</span>
<span class="n">waiting</span> <span class="k">for</span> <span class="mf">0.09</span> <span class="n">seconds</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">closing</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">closed</span>
<span class="n">registering</span> <span class="nb">open</span> <span class="n">event</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">closed</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">close_group</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">open_group</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">opening</span>
<span class="n">waiting</span> <span class="k">for</span> <span class="mf">0.08</span> <span class="n">seconds</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">opening</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">opened</span>
<span class="n">registering</span> <span class="n">close</span> <span class="n">event</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">opened</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">open_group</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">close_group</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">closing</span>
<span class="n">waiting</span> <span class="k">for</span> <span class="mf">0.07</span> <span class="n">seconds</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">closing</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">closed</span>
<span class="n">registering</span> <span class="nb">open</span> <span class="n">event</span>
</pre></div>
</div>
</section>
<section id="final-state">
<h3>Final state<a class="headerlink" href="#final-state" title="Link to this heading">¶</a></h3>
<p>In our previous example, it is obvious that once counter reaches maximum value,
door are no longer operational. Instead of limiting future operations,
we could allow one more time for user to try and operate the door. However,
since the door have reach their operational limit, it is expected that
next operation will permanently disable the door instance.</p>
<p>For those cases where future changes of statechart states is no longer
possible, final state can be used. Final state is state as any other with
one exception, once the statechart enters this state, following transitions
are not possible.</p>
<img alt="../_images/tutorial5.svg" class="drawio align-center" src="../_images/tutorial5.svg" />
<div class="literal-block-wrapper docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/cd6b92dbe5d9a626d0dc5bb779aa8d6a/door_06.scxml"><code class="xref download docutils literal notranslate"><span class="pre">door_06.scxml</span></code></a></span><a class="headerlink" href="#id22" title="Link to this code">¶</a></div>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;scxml</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/2005/07/scxml&quot;</span><span class="w"> </span><span class="na">initial=</span><span class="s">&quot;open_group&quot;</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1.0&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;open_group&quot;</span><span class="w"> </span><span class="na">initial=</span><span class="s">&quot;opened&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">        </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;close&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;close_group&quot;</span><span class="w"> </span><span class="na">cond=</span><span class="s">&quot;isOperational&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span>logTransition
<span class="w">            </span>incCounter
<span class="w">        </span><span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;close&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;final&quot;</span><span class="w"> </span><span class="na">cond=</span><span class="s">&quot;isNotOperational&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span>logTransition
<span class="w">        </span><span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;open&quot;</span><span class="nt">&gt;</span>logInvalid<span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;opened&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;/state&gt;</span>
<span class="w">        </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;opening&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>startTimer<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>stopTimer<span class="nt">&lt;/onexit&gt;</span>
<span class="w">            </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;timeout&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;opened&quot;</span><span class="nt">&gt;</span>logTransition<span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;/state&gt;</span>
<span class="w">    </span><span class="nt">&lt;/state&gt;</span>
<span class="w">    </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;close_group&quot;</span><span class="w"> </span><span class="na">initial=</span><span class="s">&quot;closing&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">        </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;open&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;opening&quot;</span><span class="w"> </span><span class="na">cond=</span><span class="s">&quot;isOperational&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span>logTransition
<span class="w">            </span>incCounter
<span class="w">        </span><span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;open&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;final&quot;</span><span class="w"> </span><span class="na">cond=</span><span class="s">&quot;isNotOperational&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span>logTransition
<span class="w">        </span><span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;close&quot;</span><span class="nt">&gt;</span>logInvalid<span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;closing&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>startTimer<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>stopTimer<span class="nt">&lt;/onexit&gt;</span>
<span class="w">            </span><span class="nt">&lt;transition</span><span class="w"> </span><span class="na">event=</span><span class="s">&quot;timeout&quot;</span><span class="w"> </span><span class="na">target=</span><span class="s">&quot;closed&quot;</span><span class="nt">&gt;</span>logTransition<span class="nt">&lt;/transition&gt;</span>
<span class="w">        </span><span class="nt">&lt;/state&gt;</span>
<span class="w">        </span><span class="nt">&lt;state</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;closed&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">            </span><span class="nt">&lt;onexit&gt;</span>logExit<span class="nt">&lt;/onexit&gt;</span>
<span class="w">        </span><span class="nt">&lt;/state&gt;</span>
<span class="w">    </span><span class="nt">&lt;/state&gt;</span>
<span class="w">    </span><span class="nt">&lt;final</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;final&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;onentry&gt;</span>logEnter<span class="nt">&lt;/onentry&gt;</span>
<span class="w">    </span><span class="nt">&lt;/final&gt;</span>
<span class="nt">&lt;/scxml&gt;</span>
</pre></div>
</div>
</div>
<p>Modification to implementation:</p>
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/6b3f7f4e07d2b113cf66a6c7f3c96e58/tutorial_09.py"><code class="xref download docutils literal notranslate"><span class="pre">tutorial_09.py</span> <span class="pre">-</span> <span class="pre">snippet</span></code></a></span><a class="headerlink" href="#id23" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">finished</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stc</span><span class="o">.</span><span class="n">finished</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_cond_is_not_operational</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stc</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_counter</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_counter</span>
</pre></div>
</div>
</div>
<p>Execution of testing sequence</p>
<div class="literal-block-wrapper docutils container" id="id24">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="../_downloads/6b3f7f4e07d2b113cf66a6c7f3c96e58/tutorial_09.py"><code class="xref download docutils literal notranslate"><span class="pre">tutorial_09.py</span> <span class="pre">-</span> <span class="pre">snippet</span></code></a></span><a class="headerlink" href="#id24" title="Link to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">door</span> <span class="o">=</span> <span class="n">Door</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">door</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">door</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">door</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;is finished:&#39;</span><span class="p">,</span> <span class="n">door</span><span class="o">.</span><span class="n">finished</span><span class="p">)</span>

    <span class="c1"># we already operated on this door instance 3 times</span>
    <span class="n">door</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;is finished:&#39;</span><span class="p">,</span> <span class="n">door</span><span class="o">.</span><span class="n">finished</span><span class="p">)</span>

    <span class="k">await</span> <span class="n">door</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>produces following output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">entering</span> <span class="n">state</span> <span class="n">open_group</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">opened</span>
<span class="n">registering</span> <span class="n">close</span> <span class="n">event</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">opened</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">open_group</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">close_group</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">closing</span>
<span class="n">waiting</span> <span class="k">for</span> <span class="mf">0.09</span> <span class="n">seconds</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">closing</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">closed</span>
<span class="n">registering</span> <span class="nb">open</span> <span class="n">event</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">closed</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">close_group</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">open_group</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">opening</span>
<span class="n">waiting</span> <span class="k">for</span> <span class="mf">0.08</span> <span class="n">seconds</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">opening</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">opened</span>
<span class="n">registering</span> <span class="n">close</span> <span class="n">event</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">opened</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">open_group</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">close_group</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">closing</span>
<span class="n">waiting</span> <span class="k">for</span> <span class="mf">0.07</span> <span class="n">seconds</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">closing</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;timeout&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">closed</span>
<span class="ow">is</span> <span class="n">finished</span><span class="p">:</span> <span class="kc">False</span>
<span class="n">registering</span> <span class="nb">open</span> <span class="n">event</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">closed</span>
<span class="n">exiting</span> <span class="n">state</span> <span class="n">close_group</span>
<span class="n">transitioning</span> <span class="n">because</span> <span class="n">of</span> <span class="n">event</span> <span class="n">Event</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;open&#39;</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
<span class="n">entering</span> <span class="n">state</span> <span class="n">final</span>
<span class="ow">is</span> <span class="n">finished</span><span class="p">:</span> <span class="kc">True</span>
</pre></div>
</div>
</section>
</section>
<section id="api">
<h2>API<a class="headerlink" href="#api" title="Link to this heading">¶</a></h2>
<p>API reference is available as part of generated documentation:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="../py_api/hat/stc.html">Python hat.stc module</a></p></li>
</ul>
</div></blockquote>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          <a class="prev-page" href="../index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Home</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2020-2025, Hat Open AUTHORS
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#"><cite>hat.stc</cite> - Python statechart library</a><ul>
<li><a class="reference internal" href="#tutorial">Tutorial</a><ul>
<li><a class="reference internal" href="#statechart-definition">Statechart definition</a></li>
<li><a class="reference internal" href="#creating-statechart-instance">Creating statechart instance</a></li>
<li><a class="reference internal" href="#running-statechart">Running statechart</a></li>
<li><a class="reference internal" href="#representing-statechart-as-python-class">Representing statechart as python class</a></li>
<li><a class="reference internal" href="#processing-registered-events">Processing registered events</a></li>
<li><a class="reference internal" href="#working-with-timeouts">Working with timeouts</a></li>
<li><a class="reference internal" href="#composite-states">Composite states</a></li>
<li><a class="reference internal" href="#advanced-transitions">Advanced transitions</a></li>
<li><a class="reference internal" href="#transition-guards">Transition guards</a></li>
<li><a class="reference internal" href="#final-state">Final state</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api">API</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>